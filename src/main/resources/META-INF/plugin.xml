<!-- Plugin Configuration File. Read more: https://plugins.jetbrains.com/docs/intellij/plugin-configuration-file.html -->
<idea-plugin require-restart="true">
    <id>com.github.zzehring.intellijjsonnet</id>
    <name>Jsonnet Language Server</name>
    <vendor>zzehring</vendor>

    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.lang</depends>
    <depends>com.redhat.devtools.lsp4ij</depends>

    <extensions defaultExtensionNs="com.redhat.devtools.lsp4ij">
        <!-- Jsonnet Language Server -->
        <server id="jsonnetLanguageServerId"
                name="Jsonnet Language Server"
                factoryClass="com.github.zzehring.intellijjsonnet.JsonnetLanguageServerFactory">
            <description><![CDATA[
Provides language support for Jsonnet files using the
<a href="https://github.com/grafana/jsonnet-language-server">Grafana Jsonnet Language Server</a>.
            ]]></description>
        </server>

        <!-- Map Jsonnet language to the server -->
        <languageMapping language="Jsonnet"
                         serverId="jsonnetLanguageServerId"
                         languageId="jsonnet"/>
    </extensions>

    <extensions defaultExtensionNs="com.intellij">
        <!-- for displaying notifications by lsp -->
        <notificationGroup id="lsp" displayType="STICKY_BALLOON"/>

        <!-- custom settings for configuring Language Server -->
        <applicationService serviceImplementation="com.github.zzehring.intellijjsonnet.settings.JLSSettingsStateComponent"/>
        <applicationConfigurable parentId="tools" instance="com.github.zzehring.intellijjsonnet.settings.JLSSettingsConfigurable"/>

        <!-- custom language stuff and things -->
        <fileType name="Jsonnet File"
                  implementationClass="com.github.zzehring.intellijjsonnet.JsonnetFileType"
                  fieldName="INSTANCE"
                  language="Jsonnet"
                  extensions="jsonnet;libsonnet"/>
        <lang.parserDefinition language="Jsonnet"
                               implementationClass="com.github.zzehring.intellijjsonnet.JsonnetParserDefinition"/>
        <lang.syntaxHighlighterFactory language="Jsonnet"
                                       implementationClass="com.github.zzehring.intellijjsonnet.JsonnetSyntaxHighlighterFactory"/>
        <lang.foldingBuilder language="Jsonnet"
                             implementationClass="com.github.zzehring.intellijjsonnet.JsonnetFoldingBuilder"/>
        <lang.braceMatcher language="Jsonnet" implementationClass="com.github.zzehring.intellijjsonnet.JsonnetBraceMatcher"/>
        <lang.commenter
                language="Jsonnet"
                implementationClass="com.github.zzehring.intellijjsonnet.SimpleCommenter"/>

    </extensions>

    <actions>
        <action id="com.github.zzehring.intellijjsonnet.actions.EvaluateJsonnetAction"
                class="com.github.zzehring.intellijjsonnet.actions.EvaluateJsonnetAction" text="Evaluate Jsonnet File"
                description="This action evaluates the current jsonnet file ">
            <add-to-group group-id="ToolsMenu" anchor="first"/>
        </action>
    </actions>
</idea-plugin>
